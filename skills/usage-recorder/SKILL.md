---
name: usage-recorder
description: 当用户主动要求记录 Claude Code 会话问题时触发。作为"记录员"角色，支持手动记录详细的会话数据，包括问题描述、类型、解决方案、耗时、优先级等。与 usage-observer（自动采集）形成互补，提供更完整的数据记录能力。是 Claude 使用分析系统的数据存储节点。
license: MIT
metadata:
  version: "1.0.0"
  author: "Claude"
  role: "recorder"
  system: "claude-usage-analytics"
  requires: "Python 3.7+"
---

# Claude Session Tracker

## Overview

本 Skill 用于记录和跟踪 Claude Code 会话中的问题和使用情况，帮助用户分析使用模式、发现问题规律并持续优化工作流程。

数据以表格形式存储在用户目录的 `.claude/claude-analysis/` 下，按日期分文件管理，支持增量记录。

## 触发条件

当用户说以下话语时自动触发：
- "记录这个问题"
- "跟踪一下这个会话"
- "保存当前问题"
- "记录到问题跟踪"
- "开始记录会话数据"
- "分析今天的使用情况"

## 数据记录字段

每次记录包含以下字段：

| 字段 | 说明 | 示例 |
|------|------|------|
| 时间戳 | 记录创建时间 | 2024-01-15 14:30:25 |
| 会话阶段 | 当前会话的阶段 | 需求分析/代码编写/调试/测试/部署 |
| 步骤描述 | 执行的具体步骤或使用的提示词 | "使用 Skill A 生成代码" |
| 问题描述 | 遇到的详细问题 | "命令执行超时" |
| 问题类型 | 问题分类 | 工具错误/理解偏差/执行失败/性能问题/其他 |
| 解决方案 | 如何解决该问题 | "增加超时时间到 60s" |
| 相关文档 | 相关的文件或文档路径 | `docs/guide.md` |
| Session ID | Claude Code 会话标识 | session_abc123 |
| 耗费时间 | 解决问题花费的时间（分钟） | 15 |
| 优先级 | 问题的重要程度 | 高/中/低 |
| 状态 | 问题处理状态 | 已解决/待解决/需跟进 |
| 备注 | 其他补充信息 | 后续需关注 |

## 工作流程

### Phase 1: 采集数据

当用户触发记录时，询问或自动采集以下信息：

1. **时间戳** - 自动生成
2. **会话阶段** - 询问用户当前处于什么阶段
3. **步骤描述** - 询问用户刚才做了什么
4. **问题描述** - 询问遇到了什么问题
5. **问题类型** - 让用户选择或自动分类
6. **解决方案** - 询问如何解决（如有）
7. **相关文档** - 询问相关文件路径（如有）
8. **Session ID** - 从环境获取或用户提供
9. **耗费时间** - 询问用户估算的时间
10. **优先级** - 询问优先级
11. **状态** - 询问当前状态
12. **备注** - 询问其他需要记录的信息

### Phase 2: 存储数据

使用脚本将数据增量写入 markdown 文件：

```bash
python scripts/record_session.py \
  --stage "代码编写" \
  --step "使用 auto-node-switcher skill" \
  --problem "Node 版本不匹配" \
  --type "工具错误" \
  --solution "使用 nvm 切换到 Node 18" \
  --docs "package.json" \
  --session "session_abc123" \
  --time "10" \
  --priority "中" \
  --status "已解决"
```

### Phase 3: 查看记录

查看当天的记录：
```bash
python scripts/view_records.py --today
```

查看指定日期的记录：
```bash
python scripts/view_records.py --date 2024-01-15
```

查看所有历史记录：
```bash
python scripts/view_records.py --all
```

## 使用方式

### 方式 1: 快速记录（推荐）

在会话中遇到问题时，直接说：
- "记录这个问题"
- "跟踪一下"

Claude 会询问必要信息并记录。

### 方式 2: 完整记录

提供完整信息：
```
记录到问题跟踪：
- 阶段：调试
- 步骤：运行测试用例
- 问题：测试失败，断言不匹配
- 类型：执行失败
- 解决方案：修改期望值
- 耗时：20分钟
- 优先级：高
- 状态：已解决
```

### 方式 3: 批量记录

会话结束时批量记录：
```
总结今天的会话并记录到跟踪表
```

### 方式 4: 查看分析

```
查看今天的问题记录
分析本周的使用模式
```

## 脚本使用

### record_session.py - 记录会话数据

**参数：**
- `--stage` / `-s`: 会话阶段（必需）
- `--step`: 步骤描述
- `--problem` / `-p`: 问题描述（必需）
- `--type` / `-t`: 问题类型
- `--solution`: 解决方案
- `--docs`: 相关文档（逗号分隔）
- `--session`: Session ID
- `--time`: 耗费时间（分钟）
- `--priority`: 优先级（高/中/低）
- `--status`: 状态（已解决/待解决/需跟进）
- `--note`: 备注
- `--date`: 指定日期（格式：YYYY-MM-DD，默认为今天）

**示例：**
```bash
python scripts/record_session.py \
  -s "代码编写" \
  -p "Skill 未触发" \
  -t "理解偏差" \
  --solution "优化 description 描述" \
  --time 15 \
  --priority "中"
```

### view_records.py - 查看记录

**参数：**
- `--today` / `-t`: 查看今天
- `--date` / `-d`: 指定日期（YYYY-MM-DD）
- `--all` / `-a`: 查看所有历史
- `--week` / `-w`: 查看本周
- `--month` / `-m`: 查看本月
- `--stats`: 显示统计信息
- `--output` / `-o`: 输出到文件

**示例：**
```bash
# 查看今天
python scripts/view_records.py --today

# 查看本周统计
python scripts/view_records.py --week --stats

# 导出本月记录
python scripts/view_records.py --month --output report.md
```

## 输出格式

### 文件结构

```
~/.claude/claude-analysis/
├── 2024-01-15.md
├── 2024-01-16.md
├── 2024-01-17.md
└── summary/
    ├── weekly_2024-W03.md
    └── monthly_2024-01.md
```

### Markdown 文件格式

每个日期的 markdown 文件包含：

```markdown
# Claude Code 会话记录 - 2024-01-15

## 概览

- 记录总数: 5
- 总耗时: 120 分钟
- 已解决问题: 4
- 待解决问题: 1

## 问题分布

| 类型 | 数量 |
|------|------|
| 工具错误 | 2 |
| 理解偏差 | 1 |
| 执行失败 | 1 |
| 性能问题 | 1 |

## 详细记录

| 时间戳 | 阶段 | 步骤 | 问题 | 类型 | 解决方案 | 耗时 | 优先级 | 状态 |
|--------|------|------|------|------|----------|------|--------|------|
| 09:30 | 需求分析 | 分析项目结构 | 文件过多难以定位 | 理解偏差 | 使用 Glob 工具批量查找 | 20 | 中 | 已解决 |
| 10:15 | 代码编写 | 创建 Skill | 描述不够清晰 | 工具错误 | 重写 description 字段 | 30 | 高 | 已解决 |
| ... | ... | ... | ... | ... | ... | ... | ... | ... |

## 备注

- 上午主要处理 skill 创建问题
- 下午专注测试和优化
```

## 示例

### Example 1: 快速记录问题

**User:** "记录这个问题"

**Claude:**
```
好的，我来记录这个问题。请告诉我：

1. 当前处于什么阶段？（如：需求分析/代码编写/调试/测试）
2. 问题描述是什么？
3. 问题类型？（工具错误/理解偏差/执行失败/性能问题/其他）
4. 有解决方案吗？
5. 大概花了多长时间？
```

**User:** "调试阶段，测试一直失败，是执行失败类型，花了20分钟还没解决"

**Claude:**
```
已记录到 2024-01-15.md：

| 时间戳 | 阶段 | 问题 | 类型 | 耗时 | 状态 |
|--------|------|------|------|------|------|
| 14:25 | 调试 | 测试一直失败 | 执行失败 | 20 | 待解决 |
```

### Example 2: 完整信息记录

**User:**
```
记录：
- 阶段：代码编写
- 步骤：使用 skill-creator 创建新 skill
- 问题：description 优化效果不佳
- 类型：工具错误
- 解决方案：重新编写描述，增加触发关键词
- 文档：SKILL.md
- 耗时：45分钟
- 优先级：高
- 状态：已解决
- 备注：需要学习如何写好的 description
```

**Claude:**
```
已记录到 2024-01-15.md

本次记录已保存。你可以随时通过 "查看今天的问题记录" 来查看所有记录。
```

### Example 3: 查看今日记录

**User:** "查看今天的问题记录"

**Claude:**
```
2024-01-15 会话记录概览：

共 3 条记录，总耗时 85 分钟

| 时间 | 阶段 | 问题 | 状态 |
|------|------|------|------|
| 09:15 | 需求分析 | 文件结构不清晰 | 已解决 |
| 10:30 | 代码编写 | description 优化 | 已解决 |
| 14:20 | 调试 | 测试失败 | 待解决 |

问题类型分布：
- 理解偏差：1
- 工具错误：1
- 执行失败：1

需要我详细显示某条记录吗？
```

### Example 4: 批量分析

**User:** "分析本周的使用模式"

**Claude:**
```
本周 (2024-W03) 会话分析：

总记录数：18
总耗时：6.5 小时
平均每日：1.3 小时

问题类型分布：
┌──────────────┬──────┬────────┐
│ 类型         │ 数量 │ 占比   │
├──────────────┼──────┼────────┤
│ 理解偏差     │ 6    │ 33.3%  │
│ 工具错误     │ 5    │ 27.8%  │
│ 执行失败     │ 4    │ 22.2%  │
│ 性能问题     │ 2    │ 11.1%  │
│ 其他         │ 1    │ 5.6%   │
└──────────────┴──────┴────────┘

解决率：78% (14/18)

高频问题：
1. Skill description 不够清晰（3次）
2. 文件查找困难（2次）
3. 测试断言失败（2次）

建议优化方向：
- 加强 skill description 编写能力
- 提高文件查找效率
```

## 问题类型说明

| 类型 | 说明 | 示例 |
|------|------|------|
| 工具错误 | 工具使用不当或工具本身问题 | Skill 未触发、命令参数错误 |
| 理解偏差 | 理解需求或上下文有误 | 误解用户意图、文件结构理解错误 |
| 执行失败 | 执行过程中出错 | 测试失败、构建失败、命令超时 |
| 性能问题 | 响应慢或资源占用高 | 处理大文件慢、内存不足 |
| 其他 | 不属于以上类别 | 文档不清晰、依赖缺失 |

## 配置

### 自定义存储路径

设置环境变量修改存储路径：
```bash
# Windows
set CLAUDE_ANALYSIS_PATH=D:\MyLogs\claude-analysis

# Mac/Linux
export CLAUDE_ANALYSIS_PATH=/home/user/mylogs/claude-analysis
```

### 自动记录模式

在 Claude 记忆中配置自动记录提示：
```
当会话遇到以下情况时，主动询问是否记录：
- 出现错误或异常
- 用户说"不对"/"错了"/"有问题"
- 同一问题反复出现
- 耗时超过 30 分钟的问题
```

## 数据分析建议

1. **每日回顾**：每天结束时花 5 分钟查看当日记录
2. **每周分析**：每周生成统计报告，发现高频问题
3. **持续优化**：根据记录调整使用方式和 skill 设计
4. **模式识别**：识别重复出现的问题，针对性改进

## 依赖

- Python 3.7+
- 无第三方依赖（使用标准库）

## 存储位置

默认存储在用户主目录：
- Windows: `%USERPROFILE%\.claude\claude-analysis\`
- Mac/Linux: `~/.claude/claude-analysis/`
